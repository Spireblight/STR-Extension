var twitch=window.Twitch.ext,last_broadcast="",last_relics="",last_potions="",last_potion_tips="",last_player_powers="",last_player_power_tips="",last_monster_powers_list="",last_monster_powers_list_tips="",last_custom_tips_list="",last_custom_tips_list_tips="",current_tooltip_id="",last_broadcast_secs=new Date/1e3,latency=0;const MSG_TYPE_SET_CONTENT=1,CHARACTERS=["Ironclad","TheSilent","Defect","Watcher"];function receiveMessage(a){var b=a[1],c=a[2];if(!(b==MSG_TYPE_SET_CONTENT))log("unrecognized msg_type: "+b);else if(last_broadcast!=a){var d=sanitizeCharacter(c.c),e=decompressPowerTips(c.w);setRelics(c.r,e,d),setPotions(c.o,e,d),setPlayerPowers(c.p,e,d),setMonsterPowers(c.m,e,d),setCustomTips(c.u,e,d)}}const RELIC_HITBOX_WIDTH=3.75,RELIC_HITBOX_LEFT=1.458,RELIC_HITBOX_MULTIPAGE_OFFSET=1.875,MAX_DISPLAY_RELICS=25,POTION_HITBOX_WIDTH=2.916,MAX_RIGHT=99,POWERTIP_WIDTH=16.406,MAX_POWERTIP_MULTICOL_HEIGHT=70,CHARACTER_POWERS_OFFSET_R=1.0416,CHARACTER_POWERS_OFFSET_L=-2.917,CHARACTER_HEALTHBAR_HEIGHT=6.666,POWERTIP_BOTTOM_MARGIN=.365,MULTICOL_COLUMN_RIGHT_MARGIN=.469,MAX_BOTTOM=98,MIN_TOP=2,SECS_NOBROADCAST_REMOVE_CONTENT=5;function sanitizeCharacter(a){for(const b of CHARACTERS)if(a==b)return a;return CHARACTERS[2]}function arraySubset(a,b){var c=[];for(let d=0;d<b.length;d++){const e=b[d];c.push(a[e])}return c}function arraySlice(a,b,c){var d=[];c||(c=a.length);for(let e=b;e<c;e++)d.push(a[e]);return d}function clearItemsByClass(a){var b=document.getElementById("items");for(let c=b.children.length-1;0<=c;c--){const d=b.children[c];d.classList.contains(a)&&b.removeChild(d)}}function decompressPowerTips(a){a=decompress(a),new_tips=[],split=a.split(";;");for(let b=0;b<split.length;b++){const a=split[b];new_tips.push(a.split(";"))}return new_tips}function setRelics(a,b,c){function d(a,b){var c=document.createElement("div");return c.className="relic-hitbox relic-marker",c.style="left: "+b+"%;",c.onmouseenter=function(b){showPowerTipStrip(b,a)},c.onmouseout=function(b){hidePowerTipStrip(b,a)},c}if(JSON.stringify(a)!=last_relics){is_relics_multipage=a[0],last_relics=JSON.stringify(a),current_tooltip_id&&current_tooltip_id.startsWith("relic")&&(current_tooltip_id=void 0),clearItemsByClass("relic-marker");var e=document.getElementById("items");for(let g=0;g<a[1].length;g++){const h=a[1][g];var f=RELIC_HITBOX_LEFT+g*RELIC_HITBOX_WIDTH+is_relics_multipage*RELIC_HITBOX_MULTIPAGE_OFFSET;e.appendChild(d("relic_"+g,f)),e.appendChild(createPowerTipStrip("relic_"+g,arraySubset(b,h),c,"relic-marker"))}}}function setPotions(a,b,c){function d(a,b){var c=document.createElement("div");return c.className="potion-hitbox potion-marker",c.style="left: "+b+"%;",c.onmouseenter=function(b){showPowerTipStrip(b,a)},c.onmouseout=function(b){hidePowerTipStrip(b,a)},c}if(a){var e=[];for(let b=1;b<a[1].length;b++)e=e.concat(a[1][b]);if(power_tips_subset=arraySubset(b,e),JSON.stringify(a)==last_potions&&JSON.stringify(power_tips_subset)==last_potion_tips)return}current_tooltip_id&&current_tooltip_id.startsWith("potion")&&(current_tooltip_id=void 0),last_potions=JSON.stringify(a),last_potion_tips=JSON.stringify(power_tips_subset),clearItemsByClass("potion-marker");var f=100*(a[0]/1920),g=document.getElementById("items");for(let e=0;e<a[1].length;e++){const i=a[1][e];var h=f-POTION_HITBOX_WIDTH/2+e*POTION_HITBOX_WIDTH;g.appendChild(d("potion_"+e,h)),g.appendChild(createPowerTipStrip("potion_"+e,arraySubset(b,i),c,"potion-marker"))}}function setPlayerPowers(a,b,c){a&&(power_tips_subset=arraySubset(b,a[4]),JSON.stringify(a)==last_player_powers&&JSON.stringify(power_tips_subset)==last_player_power_tips)||(current_tooltip_id&&current_tooltip_id.startsWith("player_powers")&&(current_tooltip_id=void 0),last_player_powers=JSON.stringify(a),last_player_power_tips=JSON.stringify(power_tips_subset),clearItemsByClass("player-powers-marker"),a&&setMulticolPowertips(a,b,"player-powers-marker","player_powers",c,1,!0))}function setMonsterPowers(a,b,c){if(a){var d=[];for(const b of a)d=d.concat(b[4]);if(power_tips_subset=arraySubset(b,d),JSON.stringify(a)==last_monster_powers_list&&JSON.stringify(power_tips_subset)==last_monster_powers_list_tips)return}if(current_tooltip_id&&current_tooltip_id.startsWith("monster_powers")&&(current_tooltip_id=void 0),last_monster_powers_list=JSON.stringify(a),last_monster_powers_list_tips=JSON.stringify(power_tips_subset),clearItemsByClass("monster-powers-marker"),a)for(let d=0;d<a.length;d++){const e=a[d];setMulticolPowertips(e,b,"monster-powers-marker","monster_powers_"+d,c,0,!0)}}function setCustomTips(a,b,c){if(a){var d=[];for(const b of a)d=d.concat(b[4]);if(power_tips_subset=arraySubset(b,d),JSON.stringify(a)==last_custom_tips_list&&JSON.stringify(power_tips_subset)==last_custom_tips_list_tips)return}if(current_tooltip_id&&current_tooltip_id.startsWith("custom_tips")&&(current_tooltip_id=void 0),last_custom_tips_list=JSON.stringify(a),last_custom_tips_list_tips=JSON.stringify(power_tips_subset),clearItemsByClass("custom-tips-marker"),a)for(let d=0;d<a.length;d++){const e=a[d];setMulticolPowertips(e,b,"custom-tips-marker","custom_tips_"+d,c,2)}}function setMulticolPowertips(a,b,c,d,e,f,g){var h=document.getElementById("items"),i={x:a[0],y:a[1],w:a[2],h:a[3]},j=a[4];h.appendChild(function(a,b,d,e,g){var h=document.createElement("div");return h.className="powers-hitbox "+c,h.style="left: "+b+"%; top: "+d+"%; width: "+e+"%; height: "+g+"%; z-index: "+f+";",h.onmouseenter=function(b){showPowerTipMulticol(b,a)},h.onmouseout=function(b){hidePowerTipMulticol(b,a)},h}(d,i.x,i.y,i.w,i.h)),h.appendChild(function(a,b,c,d,e,f,h,i){var j=Math.abs,k=document.createElement("div");k.className="powertip-multicol "+i,k.id=a;var l=$("#items").width(),m=document.body.offsetHeight,n=document.createElement("div");n.className="powertip-multicol-column",k.appendChild(n);var o=1,p=document.getElementById("temp"),q=0,r=0,s=[];for(let g=0;g<f.length;g++){const a=f[g];name=a[0],description=a[1],img=3==a.length?a[2]:void 0;var t=createPowerTip(name,description,img,h);p.appendChild(t),height_element=100*(t.offsetHeight/m)+POWERTIP_BOTTOM_MARGIN,p.removeChild(t),s.push(height_element),q+height_element>MAX_POWERTIP_MULTICOL_HEIGHT?(q>r&&(r=q),n=document.createElement("div"),n.className="powertip-multicol-column",k.appendChild(n),o+=1,q=height_element):q+=height_element,n.appendChild(t)}q>r&&(r=q);var u=r,v=o*(POWERTIP_WIDTH+MULTICOL_COLUMN_RIGHT_MARGIN),w=b+d+CHARACTER_POWERS_OFFSET_R,x=b+CHARACTER_POWERS_OFFSET_L-v,y=0;if(!(w+v>MAX_RIGHT))y=80.416>b+d?w:x;else if(0<=x)y=x;else{var z=j(x),A=j(w+v-100);y=z>A?w:x}if(g)var B=c+(e-CHARACTER_HEALTHBAR_HEIGHT)/2-.98*((c+(e-CHARACTER_HEALTHBAR_HEIGHT))/100*r)+s[0]/2.65;else var B=c+e/2-u/2;return B+u>MAX_BOTTOM&&(B=MAX_BOTTOM-u),B<MIN_TOP&&(B=MIN_TOP),k.style="left: "+y+"%; top: "+B+"%; width: "+v+"%; height: "+u+"%;",k}(d,i.x,i.y,i.w,i.h,arraySubset(b,j),e,c))}function createPowerTipStrip(a,b,c,d){var e=document.createElement("div");e.className="powertip-strip "+d,e.id=a;for(power_tip of b)name=power_tip[0],description=power_tip[1],img=3==power_tip.length?power_tip[2]:void 0,e.appendChild(createPowerTip(name,description,img,c));return e}function createPowerTip(a,b,c,d){a=sanitize(a),b=sanitize(b),c=sanitize(c);var e=document.createElement("div");e.className="powertip";var f=document.createElement("div");f.classList.add("powertip-header"),f.innerHTML=a;var g;c?(g=document.createElement("img"),g.src="img/"+c+".png",g.alt=" ",g.classList.add("powertip-img"),g.onerror=function(){this.src="img/placeholder.png"},f.appendChild(g),f.classList.add("powertip-header-wimg")):f.classList.add("powertip-header-noimg");var h=document.createElement("div");return h.innerHTML=function(a){parts=a.split(" "),new_text="",previous_special=!0;for(let b=0;b<parts.length;b++){const a=parts[b];"NL"==a?(new_text+="<br>",previous_special=!0):"TAB"==a?(new_text+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",previous_special=!0):(!previous_special&&(new_text+=" "),new_text+=a,previous_special=!1)}return new_text}(function(a,b){var c=a.split(" ");for(let d=0;d<c.length;d++){const a=c[d];if("[E]"==a){c[d]="<img src=\""+("img/orbs/orb"+b+".png")+"\" alt=\"[E]\" class=\"energy-orb-img\">"}}return c.join(" ")}(function(a){var b=a.split(" ");for(let d=0;d<b.length;d++){const e=b[d];if("#"==e.charAt(0)){var c="";switch(e.charAt(1)){case"y":c="text-yellow";break;case"b":c="text-blue";break;case"r":c="text-red";break;case"g":c="text-green";break;case"p":c="text-pink";break;default:c="text-other";}var a=e.substring(2);b[d]="<span class=\""+c+"\">"+a+"</span>"}}return b.join(" ")}(b),d)),e.appendChild(f),e.appendChild(h),e}function sanitize(a){return a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;"):a}function showPowerTipStrip(a,b){current_tooltip_id=b,movePowerTipStrip(a),document.getElementById(b).style.display="block"}function hidePowerTipStrip(a,b){current_tooltip_id=void 0,document.getElementById(b).style.display="none"}function showPowerTipMulticol(a,b){current_tooltip_id=b,document.getElementById(b).style.display="block"}function hidePowerTipMulticol(a,b){current_tooltip_id=void 0,document.getElementById(b).style.display="none"}function movePowerTipStrip(a){if(null!=current_tooltip_id&&(current_tooltip_id.startsWith("relic")||current_tooltip_id.startsWith("potion"))){var b=a.pageX+52,c=a.pageY+7,d=$("#items").width();b>(MAX_RIGHT-POWERTIP_WIDTH)/100*d&&(b=a.pageX-24-12-POWERTIP_WIDTH/100*d,c=a.pageY+7),$("#"+current_tooltip_id).css({left:b+"px",top:c+"px"})}}function log(a){console.log(a)}const WILDCARDS="0123456789abcdefghijklmnopqrstvwxyzABCDEFGHIJKLMNOPQRSTVWXYZ_`[]/^%?@><=-+*:;,.()#$!'{}~";function escapeRegex(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function decompress(a){parts=a.split("||"),compression_dict=parts[0].split("|");var b=parts[1];for(let c=compression_dict.length-1;0<=c;c--){const a=compression_dict[c],d="&"+WILDCARDS[c];b=b.replace(new RegExp(escapeRegex(d),"g"),a)}return b}function checkIfSourceActive(){var a=new Date/1e3;a-last_broadcast_secs>SECS_NOBROADCAST_REMOVE_CONTENT&&(msg=[0,1,{c:"",r:[0,[]],o:[0,[]],w:"||"}],receiveMessage(msg))}function testingMessage(){msg=[0,1,{c:"",r:[0,[]],o:[0,[]],u:[[20,20,20,20,[0]]],w:"||This is a Tip;#yHey there how  are you? NL NL NL TAB this is a tab test NL TAB TAB double NL TAB a TAB a"}],receiveMessage(msg)}const PRELOAD_IMAGES=["img/intents/attackBuff.png","img/intents/attackDebuff.png","img/intents/attackDefend.png","img/intents/buff1.png","img/intents/debuff1.png","img/intents/debuff2.png","img/intents/defend.png","img/intents/defendBuff.png","img/intents/escape.png","img/intents/magic.png","img/intents/sleep.png","img/intents/special.png","img/intents/stun.png","img/intents/tip/1.png","img/intents/tip/2.png","img/intents/tip/3.png","img/intents/tip/4.png","img/intents/tip/5.png","img/intents/tip/6.png","img/intents/tip/7.png","img/intents/unknown.png","img/magGlass2.png","img/orbs/orb.png","img/orbs/orbDefect.png","img/orbs/orbIronclad.png","img/orbs/orbTheSilent.png","img/orbs/orbWatcher.png","img/placeholder.png","img/powers/48/accuracy.png","img/powers/48/afterImage.png","img/powers/48/ai.png","img/powers/48/amplify.png","img/powers/48/anger.png","img/powers/48/armor.png","img/powers/48/artifact.png","img/powers/48/attackBurn.png","img/powers/48/backAttack.png","img/powers/48/backAttack2.png","img/powers/48/barricade.png","img/powers/48/beat.png","img/powers/48/berserk.png","img/powers/48/bias.png","img/powers/48/blur.png","img/powers/48/book.png","img/powers/48/brutality.png","img/powers/48/buffer.png","img/powers/48/burst.png","img/powers/48/carddraw.png","img/powers/48/cExplosion.png","img/powers/48/channel.png","img/powers/48/choke.png","img/powers/48/closeUp.png","img/powers/48/combust.png","img/powers/48/confusion.png","img/powers/48/conserve.png","img/powers/48/constricted.png","img/powers/48/controlled_change.png","img/powers/48/corruption.png","img/powers/48/curiosity.png","img/powers/48/darkembrace.png","img/powers/48/defenseNext.png","img/powers/48/demonForm.png","img/powers/48/deva.png","img/powers/48/deva2.png","img/powers/48/devotion.png","img/powers/48/dexterity.png","img/powers/48/doubleDamage.png","img/powers/48/doubleTap.png","img/powers/48/draw.png","img/powers/48/draw2.png","img/powers/48/echo.png","img/powers/48/end_turn_death.png","img/powers/48/energized_blue.png","img/powers/48/energized_green.png","img/powers/48/entangle.png","img/powers/48/envenom.png","img/powers/48/establishment.png","img/powers/48/evolve.png","img/powers/48/explosive.png","img/powers/48/fading.png","img/powers/48/fasting.png","img/powers/48/firebreathing.png","img/powers/48/flameBarrier.png","img/powers/48/flex.png","img/powers/48/flight.png","img/powers/48/focus.png","img/powers/48/forcefield.png","img/powers/48/frail.png","img/powers/48/fumes.png","img/powers/48/heartDef.png","img/powers/48/heatsink.png","img/powers/48/hello.png","img/powers/48/hex.png","img/powers/48/hymn.png","img/powers/48/infiniteBlades.png","img/powers/48/infinitegreen.png","img/powers/48/int.png","img/powers/48/intangible.png","img/powers/48/juggernaut.png","img/powers/48/lessdraw.png","img/powers/48/like_water.png","img/powers/48/lockon.png","img/powers/48/loop.png","img/powers/48/magnet.png","img/powers/48/malleable.png","img/powers/48/mantra.png","img/powers/48/mastery.png","img/powers/48/master_protect.png","img/powers/48/master_reality.png","img/powers/48/master_smite.png","img/powers/48/mayhem.png","img/powers/48/mental_fortress.png","img/powers/48/minion.png","img/powers/48/modeShift.png","img/powers/48/nightmare.png","img/powers/48/nirvana.png","img/powers/48/noattack.png","img/powers/48/noBlock.png","img/powers/48/noDraw.png","img/powers/48/noPain.png","img/powers/48/no_skill.png","img/powers/48/no_stance.png","img/powers/48/omega.png","img/powers/48/painfulStabs.png","img/powers/48/panache.png","img/powers/48/path_to_victory.png","img/powers/48/penNib.png","img/powers/48/phantasmal.png","img/powers/48/platedarmor.png","img/powers/48/poison.png","img/powers/48/pressure_points.png","img/powers/48/reactive.png","img/powers/48/rebound.png","img/powers/48/regen.png","img/powers/48/regrow.png","img/powers/48/repair.png","img/powers/48/retain.png","img/powers/48/ritual.png","img/powers/48/rupture.png","img/powers/48/rushdown.png","img/powers/48/sadistic.png","img/powers/48/shackle.png","img/powers/48/sharpHide.png","img/powers/48/shift.png","img/powers/48/skillBurn.png","img/powers/48/slow.png","img/powers/48/split.png","img/powers/48/sporeCloud.png","img/powers/48/stasis.png","img/powers/48/static_discharge.png","img/powers/48/storm.png","img/powers/48/strength.png","img/powers/48/surrounded.png","img/powers/48/swivel.png","img/powers/48/talk_to_hand.png","img/powers/48/the_bomb.png","img/powers/48/thievery.png","img/powers/48/thorns.png","img/powers/48/thousandCuts.png","img/powers/48/time.png","img/powers/48/tools.png","img/powers/48/unawakened.png","img/powers/48/vigor.png","img/powers/48/vulnerable.png","img/powers/48/wave_of_the_hand.png","img/powers/48/weak.png","img/powers/48/wireheading.png","img/powers/48/wraithForm.png"],MAX_CONCURRENT_PRELOADS=2,PRELOAD_INTERVAL=250;preload_workers_available=MAX_CONCURRENT_PRELOADS,image_preload_index=0;function preloadImages(a){preloadImages.list||(preloadImages.list=[]);for(var b,c=preloadImages.list,d=0;d<a.length;d++)b=new Image,preload_workers_available-=1,b.onload=function(){preload_workers_available+=1;var a=c.indexOf(this);-1!==a&&c.splice(a,1)},c.push(b),b.src=a[d]}function preloadNextImageBunch(){let a=[],b=preload_workers_available;for(let c=image_preload_index;c<image_preload_index+b&&c<PRELOAD_IMAGES.length;c++)a.push(PRELOAD_IMAGES[c]);image_preload_index+=b,preloadImages(a),image_preload_index<PRELOAD_IMAGES.length&&window.setTimeout(preloadNextImageBunch,PRELOAD_INTERVAL)}$(function(){window.Twitch.ext.onContext(a=>{a.hlsLatencyBroadcaster&&(latency=a.hlsLatencyBroadcaster)}),twitch.listen("broadcast",function(a,b,c){decomp_message=LZString.decompressFromEncodedURIComponent(c);var d=JSON.parse(decomp_message),e=Math.ceil(d[0]+1e3*latency);window.setTimeout(function(){receiveMessage(d)},Math.max(0,e)),last_broadcast_secs=new Date/1e3}),$("#items").on("mousemove",movePowerTipStrip),window.setInterval(checkIfSourceActive,2500),window.setTimeout(preloadNextImageBunch,PRELOAD_INTERVAL)});